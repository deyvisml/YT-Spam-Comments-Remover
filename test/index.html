<html>
  <head></head>
  <body>
    <script>
      /*var YOUR_CLIENT_ID =
        "638815897163-tuf2u2l8bq6if08q4jjsod090l32kda4.apps.googleusercontent.com";*/
      var YOUR_CLIENT_ID =
        "125209851600-nvi71ibqif55r4k1lmuuv1473p24jvpm.apps.googleusercontent.com";
      var YOUR_REDIRECT_URI = "http://localhost:5500";
      var fragmentString = location.hash.substring(1);

      // Parse query string to see if page request is coming from OAuth 2.0 server.
      var params = {};
      var regex = /([^&=]+)=([^&]*)/g,
        m;
      while ((m = regex.exec(fragmentString))) {
        params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
      }
      if (Object.keys(params).length > 0) {
        localStorage.setItem("oauth2-test-params", JSON.stringify(params));
        if (params["state"] && params["state"] == "try_sample_request") {
          console.log("Existen credenciales en el local STORAGE");
          //trySampleRequest();
        }
      }

      // If there's an access token, try an API request.
      // Otherwise, start OAuth 2.0 flow.
      function trySampleRequest() {
        var params = JSON.parse(localStorage.getItem("oauth2-test-params"));
        if (params && params["access_token"]) {
          console.log(params["access_token"]);

          console.log("FETCHING ...");
          const comment_id = "Ugz7NXdkXoC_u7A08LF4AaABAg"; // my own comment and also in my own video
          const moderationStatus = "rejected";
          //const comment_id = "Ugw_LhutyJSnuXt4A8R4AaABAg"; // it is not my comment (also it is not in my videos)
          const video_id = "H3rNA9H-kB4";

          //const url = `https://youtube.googleapis.com/youtube/v3/comments/setModerationStatus?id=${comment_id}&access_token=${params["access_token"]}`; // DELETE A COMMENT
          //const url = `https://youtube.googleapis.com/youtube/v3/comments/markAsSpam?id=${comment_id}&access_token=${params["access_token"]}`; // REPORT A COMMENT
          //const url = `https://youtube.googleapis.com/youtube/v3/commentThreads?part=snippet%2Creplies&maxResults=100&order=relevance&videoId=${video_id}&access_token=${params["access_token"]}`;

          /* TESTING */
          const url =
            "https://youtube.googleapis.com/youtube/v3/comments/markAsSpam";

          const headers = {
            Authorization: `Bearer ${params["access_token"]}`,
            "Content-Type": "application/json",
          };

          const payload = {
            id: ["Ugw_LhutyJSnuXt4A8R4AaABAg", "Ugw_LhutyJSnuXt4A8R4AaABAg"],
          };

          fetch(url, {
            method: "POST",
            headers: headers,
            body: JSON.stringify(payload),
          })
            .then((response) => {
              // Aquí puedes manejar la respuesta del servidor
              console.log("data2", response);
            })
            .catch((error) => {
              // Aquí puedes manejar errores de la solicitud
              console.error("Error:", error);
            });
          /* END TESTING */

          /*
          fetch(url, {
            method: "POST",
          })
            .then((response) => response.json())
            .then((data) => {
              // Aquí puedes manejar la respuesta del servidor
              console.log("data2", data);
            })
            .catch((error) => {
              // Aquí puedes manejar errores de la solicitud
              console.error("Error:", error);
            });
            */
        } else {
          oauth2SignIn();
        }
      }

      /*
       * Create form to request access token from Google's OAuth 2.0 server.
       */
      function oauth2SignIn() {
        // Google's OAuth 2.0 endpoint for requesting an access token
        var oauth2Endpoint = "https://accounts.google.com/o/oauth2/v2/auth";

        // Create element to open OAuth 2.0 endpoint in new window.
        var form = document.createElement("form");
        form.setAttribute("method", "GET"); // Send as a GET request.
        form.setAttribute("action", oauth2Endpoint);

        // Parameters to pass to OAuth 2.0 endpoint.
        var params = {
          client_id: YOUR_CLIENT_ID,
          redirect_uri: YOUR_REDIRECT_URI,
          scope: "https://www.googleapis.com/auth/youtube.force-ssl",
          state: "try_sample_request",
          include_granted_scopes: "true",
          response_type: "token",
        };

        // Add form parameters as hidden input values.
        for (var p in params) {
          var input = document.createElement("input");
          input.setAttribute("type", "hidden");
          input.setAttribute("name", p);
          input.setAttribute("value", params[p]);
          form.appendChild(input);
        }

        // Add form to page and submit it to open the OAuth 2.0 endpoint.
        document.body.appendChild(form);
        form.submit();
      }
    </script>

    <button onclick="trySampleRequest();">Try sample request</button>
  </body>
</html>
